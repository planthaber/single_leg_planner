%sherpaTTFKAcc.m
%author: wreid
%date: 20150123

function uDotDot = sherpaTTFKAcc(qDotDot,qDot,q,kC)
%sherpaTTFKAcc Sherpa_TT single leg forward acceleration kinematics.

    alpha = q(1);
    beta = q(2);
    gamma = q(3);
    phi = 0;
    
    alphaDot = qDot(1);
    betaDot = qDot(2);
    gammaDot = qDot(3);

    alphaDotDot = qDotDot(1);
    betaDotDot = qDotDot(2);
    gammaDotDot = qDotDot(3);
    
%     J = [                                                                                                                                                              0.5*kC.l3*sin(beta - 1.0*phi) - 0.5*kC.l4*sin(phi + kC.zetz) - 0.5*kC.l3*sin(beta + phi) - 1.225e-16*kC.l7*cos(phi) - 1.225e-16*kC.l8*cos(phi) - 0.5*kC.l4*sin(phi - 1.0*kC.zetz) - 1.0*kC.l2*sin(phi) + 1.0*kC.l6*sin(phi) - 0.5*kC.l5*sin(gamma + phi + kC.zetz) + 0.5*kC.l5*sin(gamma - 1.0*phi + kC.zetz),                                                                                                                           0.5*kC.l4*sin(phi - 1.0*kC.zetz) - 0.5*kC.l4*sin(phi + kC.zetz) - 0.5*kC.l3*sin(beta - 1.0*phi) - 1.0*kC.l7*cos(phi) - 1.0*kC.l8*cos(phi) - 0.5*kC.l3*sin(beta + phi) - 6.123e-17*kC.l6*sin(phi) - 0.5*kC.l5*sin(gamma + phi + kC.zetz) - 0.5*kC.l5*sin(gamma - 1.0*phi + kC.zetz),                                                                                            0.5*kC.l4*sin(phi - 1.0*kC.zetz) - 1.0*kC.l7*cos(phi) - 1.0*kC.l8*cos(phi) - 0.5*kC.l4*sin(phi + kC.zetz) - 6.123e-17*kC.l6*sin(phi) - 0.5*kC.l5*sin(gamma + phi + kC.zetz) - 0.5*kC.l5*sin(gamma - 1.0*phi + kC.zetz);
%                                                        1.5e-32*kC.l2 - 1.5e-32*kC.l6 + 0.5*kC.l3*cos(beta + phi) + 1.5e-32*kC.l5*cos(gamma + kC.zetz) + 0.5*kC.l4*cos(phi + kC.zetz) + 0.5*kC.l3*cos(beta - 1.0*phi) + 1.5e-32*kC.l3*cos(beta) + 0.5*kC.l4*cos(phi - 1.0*kC.zetz) + 1.0*kC.l2*cos(phi) - 1.0*kC.l6*cos(phi) + 1.5e-32*kC.l4*cos(kC.zetz) - 1.225e-16*kC.l7*sin(phi) - 1.225e-16*kC.l8*sin(phi) + 0.5*kC.l5*cos(gamma + phi + kC.zetz) + 0.5*kC.l5*cos(gamma - 1.0*phi + kC.zetz),                         0.5*kC.l3*cos(beta + phi) - 1.225e-16*kC.l6 + 1.225e-16*kC.l5*cos(gamma + kC.zetz) + 0.5*kC.l4*cos(phi + kC.zetz) - 0.5*kC.l3*cos(beta - 1.0*phi) + 1.225e-16*kC.l3*cos(beta) - 0.5*kC.l4*cos(phi - 1.0*kC.zetz) + 6.123e-17*kC.l6*cos(phi) + 1.225e-16*kC.l4*cos(kC.zetz) - 1.0*kC.l7*sin(phi) - 1.0*kC.l8*sin(phi) + 0.5*kC.l5*cos(gamma + phi + kC.zetz) - 0.5*kC.l5*cos(gamma - 1.0*phi + kC.zetz),                   1.225e-16*kC.l5*cos(gamma + kC.zetz) - 1.225e-16*kC.l6 + 0.5*kC.l4*cos(phi + kC.zetz) - 0.5*kC.l4*cos(phi - 1.0*kC.zetz) + 6.123e-17*kC.l6*cos(phi) + 1.225e-16*kC.l4*cos(kC.zetz) - 1.0*kC.l7*sin(phi) - 1.0*kC.l8*sin(phi) + 0.5*kC.l5*cos(gamma + phi + kC.zetz) - 0.5*kC.l5*cos(gamma - 1.0*phi + kC.zetz);
%         1.225e-16*kC.l6 - 1.225e-16*kC.l2 + 6.123e-17*kC.l3*cos(beta + phi) - 1.225e-16*kC.l5*cos(gamma + kC.zetz) + 6.123e-17*kC.l4*cos(phi + kC.zetz) + 6.123e-17*kC.l3*cos(beta - 1.0*phi) - 1.225e-16*kC.l3*cos(beta) + 6.123e-17*kC.l4*cos(phi - 1.0*kC.zetz) + 1.225e-16*kC.l2*cos(phi) - 1.225e-16*kC.l6*cos(phi) - 1.225e-16*kC.l4*cos(kC.zetz) - 1.5e-32*kC.l7*sin(phi) - 1.5e-32*kC.l8*sin(phi) + 6.123e-17*kC.l5*cos(gamma + phi + kC.zetz) + 6.123e-17*kC.l5*cos(gamma - 1.0*phi + kC.zetz), 1.0*kC.l6 + 6.123e-17*kC.l3*cos(beta + phi) - 1.0*kC.l5*cos(gamma + kC.zetz) + 6.123e-17*kC.l4*cos(phi + kC.zetz) - 6.123e-17*kC.l3*cos(beta - 1.0*phi) - 1.0*kC.l3*cos(beta) - 6.123e-17*kC.l4*cos(phi - 1.0*kC.zetz) + 7.499e-33*kC.l6*cos(phi) - 1.0*kC.l4*cos(kC.zetz) - 1.225e-16*kC.l7*sin(phi) - 1.225e-16*kC.l8*sin(phi) + 6.123e-17*kC.l5*cos(gamma + phi + kC.zetz) - 6.123e-17*kC.l5*cos(gamma - 1.0*phi + kC.zetz), 1.0*kC.l6 - 1.0*kC.l5*cos(gamma + kC.zetz) + 6.123e-17*kC.l4*cos(phi + kC.zetz) - 6.123e-17*kC.l4*cos(phi - 1.0*kC.zetz) + 7.499e-33*kC.l6*cos(phi) - 1.0*kC.l4*cos(kC.zetz) - 1.225e-16*kC.l7*sin(phi) - 1.225e-16*kC.l8*sin(phi) + 6.123e-17*kC.l5*cos(gamma + phi + kC.zetz) - 6.123e-17*kC.l5*cos(gamma - 1.0*phi + kC.zetz)];
%     
%     JDot = [ 0,                        -6.163e-33*kC.l3*(8.113e31*cos(beta + phi) + 8.113e31*cos(beta - 1.0*phi)),                              -6.163e-33*kC.l5*(8.113e31*cos(gamma + phi + kC.zetz) + 8.113e31*cos(gamma - 1.0*phi + kC.zetz));
%             0, -1.233e-32*kC.l3*(9.936e15*sin(beta) + 8.113e31*cos(beta)*sin(phi) - 4.968e15*cos(phi)*sin(beta)), -6.163e-33*kC.l5*(8.113e31*sin(gamma + phi + kC.zetz) - 8.113e31*sin(gamma - 1.0*phi + kC.zetz) + 1.987e16*sin(gamma + kC.zetz));
%             0,   3.039e-64*kC.l3*(3.291e63*sin(beta) - 4.03e47*cos(beta)*sin(phi) + 2.468e31*cos(phi)*sin(beta)),    1.519e-64*kC.l5*(4.03e47*sin(gamma - 1.0*phi + kC.zetz) - 4.03e47*sin(gamma + phi + kC.zetz) + 6.582e63*sin(gamma + kC.zetz))];
%     
    %uDotDot = J*qDotDot + JDot*qDot;
    
    xDotDot =   -alphaDotDot*sin(alpha)*(kC.l2 - kC.l7 + kC.l5*cos(gamma + kC.zetz) + kC.l3*cos(beta) + kC.l4*cos(kC.zetz))...
            -alphaDot^2*cos(alpha)*(kC.l2 - kC.l7 + kC.l5*cos(gamma + kC.zetz) + kC.l3*cos(beta) + kC.l4*cos(kC.zetz))...
            +alphaDot*betaDot*kC.l3*sin(beta)*sin(alpha)...
            +alphaDot*gammaDot*kC.l5*sin(kC.zetz+gamma)*sin(alpha)...
            -betaDotDot*kC.l3*sin(beta)*cos(alpha)...
            -betaDot^2*kC.l3*cos(beta)*cos(alpha)...
            -gammaDotDot*kC.l5*sin(kC.zetz+gamma)*cos(alpha)...
            -gammaDot^2*kC.l5*cos(kC.zetz+gamma)*cos(alpha);
    
    yDotDot =   alphaDotDot*cos(alpha)*(kC.l2 - kC.l7 + kC.l5*cos(gamma + kC.zetz) + kC.l3*cos(beta) + kC.l4*cos(kC.zetz))...
            -alphaDot^2*sin(alpha)*(kC.l2 - kC.l7 + kC.l5*cos(gamma + kC.zetz) + kC.l3*cos(beta) + kC.l4*cos(kC.zetz))...
            -alphaDot*betaDot*kC.l3*cos(alpha)*sin(beta)...
            -alphaDot*gammaDot*kC.l5*sin(kC.zetz+gamma)*cos(alpha)...
            -gammaDotDot*kC.l5*sin(kC.zetz+gamma)*sin(alpha)...
            -gammaDot^2*kC.l5*cos(kC.zetz+gamma)*sin(alpha)...
            -betaDotDot*kC.l3*sin(alpha)*sin(beta)...
            -betaDot^2*kC.l3*sin(alpha)*cos(beta);
        
    zDotDot =   -betaDotDot*kC.l3*cos(beta)...
            +betaDot^2*kC.l3*sin(beta)...
            -gammaDotDot*kC.l5*cos(kC.zetz+gamma)...
            +gammaDot^2*kC.l5*sin(kC.zetz+gamma);
        
    uDotDot = [xDotDot; yDotDot; zDotDot];

end