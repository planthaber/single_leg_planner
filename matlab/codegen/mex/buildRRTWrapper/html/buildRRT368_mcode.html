<pre class="code">
<span class="srcline"><span class="lineno"><a href="119,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">%buildRRT.m</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%author: wreid</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%date: 20150107</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="119,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T52U3">T</span>,<span class="var type1" id="S3T62U4">path</span>] = buildRRT(<span class="var type1" id="S4T46U7">nInit</span>,<span class="var type1" id="S5T46U8">nGoal</span>,<span class="var type1" id="S6T9U9">NUM_NODES</span>,<span class="var type1" id="S7T5U10">jointLimits</span>,<span class="var type1" id="S8T7U11">cartesianLimits</span>,<span class="var type1" id="S9T4U12">panHeight</span>,<span class="var type1" id="S10T8U13">HGAINS</span>,<span class="var type1" id="S11T9U14">NODE_SIZE</span>,<span class="var type1" id="S12T47U15">U</span>,<span class="var type1" id="S13T9U16">U_SIZE</span>,<span class="var type1" id="S14T4U17">dt</span>,<span class="var type1" id="S15T4U18">Dt</span>,<span class="var type1" id="S16T6U19">kC</span>,<span class="var type1" id="S17T4U20">ankleThreshold</span>,<span class="var type1" id="S18T1U21">exhaustive</span>,<span class="var type1" id="S19T4U22">threshold</span>,<span class="var type1" id="S20T9U23">goalSeedFreq</span>,<span class="var type1" id="S21T48U24">uBDot</span>,<span class="var type1" id="S22T4U25">phiInit</span>,<span class="var type1" id="S23T4U26">omegaInit</span>,<span class="var type1" id="S24T9U27">legNum</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="119,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%buildRRT Icrementally builds a rapidly exploring random tree.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   An RRT is build by incrementally selecting a random state from the</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   available state space as defined by the MIN and MAX vectors. The tree is</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   started at xInit and is extended until the number of maximum nodes, K has</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   been reached. A path is selected if the goal region as defined by xGoal</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   has been reached by the RRT.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="119,13" id="srcline13">13</a></span><span class="line">    <span class="comment">%Transform the initial and goal nodes into state structures.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T51:U24"><span class="var type1" id="S25T51U30">sInit</span> = <span class="mxinfo " id="T51:U26"><span class="fcn" id="F202N24:B32">makeState</span>(1,0,0,<span class="mxinfo " id="T4:U27"><span class="var type1" id="S4T46U37">nInit</span>(<span class="mxinfo " id="T4:U29">4</span>)</span>,<span class="mxinfo " id="T4:U30"><span class="var type1" id="S4T46U40">nInit</span>(<span class="mxinfo " id="T4:U32">5</span>)</span>,<span class="mxinfo " id="T4:U33"><span class="var type1" id="S4T46U43">nInit</span>(<span class="mxinfo " id="T4:U35">6</span>)</span>,<span class="mxinfo " id="T4:U36"><span class="var type1" id="S4T46U46">nInit</span>(<span class="mxinfo " id="T4:U38">7</span>)</span>,<span class="mxinfo " id="T4:U39"><span class="var type1" id="S4T46U49">nInit</span>(<span class="mxinfo " id="T4:U41">8</span>)</span>,<span class="mxinfo " id="T4:U42"><span class="var type1" id="S4T46U52">nInit</span>(<span class="mxinfo " id="T4:U44">9</span>)</span>,<span class="var type1" id="S22T4U54">phiInit</span>,<span class="var type1" id="S23T4U55">omegaInit</span>,<span class="var type1" id="S14T4U56">dt</span>,<span class="var type1" id="S15T4U57">Dt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T51:U49"><span class="var type1" id="S27T51U60">sGoal</span> = <span class="mxinfo " id="T51:U51"><span class="fcn" id="F202N24:B62">makeState</span>(1,0,0,<span class="mxinfo " id="T4:U52"><span class="var type1" id="S5T46U67">nGoal</span>(<span class="mxinfo " id="T4:U54">4</span>)</span>,<span class="mxinfo " id="T4:U55"><span class="var type1" id="S5T46U70">nGoal</span>(<span class="mxinfo " id="T4:U57">5</span>)</span>,<span class="mxinfo " id="T4:U58"><span class="var type1" id="S5T46U73">nGoal</span>(<span class="mxinfo " id="T4:U60">6</span>)</span>,<span class="mxinfo " id="T4:U61"><span class="var type1" id="S5T46U76">nGoal</span>(<span class="mxinfo " id="T4:U63">7</span>)</span>,<span class="mxinfo " id="T4:U64"><span class="var type1" id="S5T46U79">nGoal</span>(<span class="mxinfo " id="T4:U66">8</span>)</span>,<span class="mxinfo " id="T4:U67"><span class="var type1" id="S5T46U82">nGoal</span>(<span class="mxinfo " id="T4:U69">9</span>)</span>,<span class="mxinfo " id="T4:U70">0</span>,<span class="mxinfo " id="T4:U71">0</span>,<span class="var type1" id="S14T4U86">dt</span>,<span class="var type1" id="S15T4U87">Dt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="119,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T52:U74"><span class="var type1" id="S2T52U90">T</span> = <span class="mxinfo " id="T51:U76"><span class="fcn" id="F204N22:B92">makeEmptyState</span>(<span class="var type1" id="S14T4U93">dt</span>,<span class="var type1" id="S15T4U94">Dt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%Initialize the tree.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,19" id="srcline19">19</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T9U97">i</span> = <span class="mxinfo " id="T9:U80">1</span>:<span class="mxinfo " id="T9:U81"><span class="var type1" id="S6T9U101">NUM_NODES</span>-<span class="mxinfo " id="T9:U83">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="119,20" id="srcline20">20</a></span><span class="line">        <span class="mxinfo " id="T52:U84"><span class="var type1" id="S2T52U105">T</span> = <span class="mxinfo " id="T52:U86">[<span class="var type1" id="S2T52U108">T</span> <span class="mxinfo " id="T51:U88"><span class="fcn" id="F204N22:B110">makeEmptyState</span>(<span class="var type1" id="S14T4U111">dt</span>,<span class="var type1" id="S15T4U112">Dt</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T51:U91"><span class="mxinfo " id="T51:U92"><span class="var type1" id="S2T52U116">T</span>(<span class="mxinfo " id="T4:U94">1</span>)</span> = <span class="var type1" id="S25T51U118">sInit</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,23" id="srcline23">23</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="119,24" id="srcline24">24</a></span><span class="line">    <span class="comment">%Initialize the node count.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T4:U96"><span class="var type1" id="S30T4U121">nodeIDCount</span> = <span class="mxinfo " id="T4:U98">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,26" id="srcline26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="119,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T1:U99">~<span class="var type1" id="S18T1U126">exhaustive</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="119,28" id="srcline28">28</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S29T9U129">i</span> = <span class="mxinfo " id="T9:U102">2</span>:<span class="mxinfo " id="T9:U103"><span class="var type1" id="S6T9U132">NUM_NODES</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="119,29" id="srcline29">29</a></span><span class="line">            [<span class="mxinfo " id="T52:U105"><span class="var type1" id="S2T52U136">T</span></span>,<span class="mxinfo " id="T4:U107"><span class="var type1" id="S30T4U137">nodeIDCount</span></span>] = <span class="fcn" id="F365N5:B139">rrtLoop</span>(<span class="var type1" id="S2T52U140">T</span>,<span class="var type1" id="S7T5U141">jointLimits</span>,<span class="var type1" id="S8T7U142">cartesianLimits</span>,<span class="var type1" id="S16T6U143">kC</span>,<span class="var type1" id="S9T4U144">panHeight</span>,<span class="var type1" id="S12T47U145">U</span>,<span class="var type1" id="S15T4U146">Dt</span>,<span class="var type1" id="S14T4U147">dt</span>,<span class="var type1" id="S11T9U148">NODE_SIZE</span>,<span class="mxinfo " id="T9:U118"><span class="var type1" id="S13T9U149">U_SIZE</span></span>,<span class="var type1" id="S10T8U150">HGAINS</span>,<span class="mxinfo " id="T4:U121"><span class="var type1" id="S17T4U151">ankleThreshold</span></span>,<span class="var type1" id="S30T4U152">nodeIDCount</span>,<span class="var type1" id="S27T51U153">sGoal</span>,<span class="mxinfo " id="T9:U125"><span class="var type1" id="S20T9U154">goalSeedFreq</span></span>,<span class="var type1" id="S21T48U155">uBDot</span>,<span class="var type1" id="S24T9U156">legNum</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="119,30" id="srcline30">30</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,31" id="srcline31">31</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,32" id="srcline32">32</a></span><span class="line">        <span class="comment">%TODO: calculate maximum distance given the configuration space.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,33" id="srcline33">33</a></span><span class="line">        <span class="var type1" id="S32T4U160">dist</span> = 100;</span></span>
<span class="srcline"><span class="lineno"><a href="119,34" id="srcline34">34</a></span><span class="line">        <span class="comment">%TODO: make the threshold distance</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,35" id="srcline35">35</a></span><span class="line">        <span class="keyword">while</span> <span class="var type1" id="S32T4U165">dist</span> &gt; <span class="var type1" id="S19T4U166">threshold</span> &amp;&amp; <span class="var type1" id="S30T4U168">nodeIDCount</span> &lt; <span class="var type1" id="S6T9U169">NUM_NODES</span> </span></span>
<span class="srcline"><span class="lineno"><a href="119,36" id="srcline36">36</a></span><span class="line">            [<span class="var type1" id="S2T64U173">T</span>,<span class="var type1" id="S30T4U174">nodeIDCount</span>] = <span class="fcn" id="F365N5:B176">rrtLoop</span>(<span class="var type1" id="S2T52U177">T</span>,<span class="var type1" id="S7T5U178">jointLimits</span>,<span class="var type1" id="S8T7U179">cartesianLimits</span>,<span class="var type1" id="S16T6U180">kC</span>,<span class="var type1" id="S9T4U181">panHeight</span>,<span class="var type1" id="S12T47U182">U</span>,<span class="var type1" id="S15T4U183">Dt</span>,<span class="var type1" id="S14T4U184">dt</span>,<span class="var type1" id="S11T9U185">NODE_SIZE</span>,<span class="var type1" id="S13T9U186">U_SIZE</span>,<span class="var type1" id="S10T8U187">HGAINS</span>,<span class="var type1" id="S17T4U188">ankleThreshold</span>,<span class="var type1" id="S30T4U189">nodeIDCount</span>,<span class="var type1" id="S27T51U190">sGoal</span>,<span class="var type1" id="S20T9U191">goalSeedFreq</span>,<span class="var type1" id="S21T48U192">uBDot</span>,<span class="var type1" id="S24T9U193">legNum</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="119,37" id="srcline37">37</a></span><span class="line">            [<span class="mxinfo " id="T51:U153">~</span>,<span class="var type1" id="S32T4U198">dist</span>] = <span class="fcn" id="F266N26:B200">nearestNeighbour</span>(<span class="var type1" id="S27T51U201">sGoal</span>,<span class="var type1" id="S2T52U202">T</span>,<span class="var type1" id="S10T8U203">HGAINS</span>,<span class="var type1" id="S7T5U204">jointLimits</span>,<span class="var type1" id="S16T6U205">kC</span>,<span class="var type1" id="S30T4U206">nodeIDCount</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="119,38" id="srcline38">38</a></span><span class="line">            <span class="keyword">if</span> mod(<span class="var type1" id="S30T4U212">nodeIDCount</span>,100) == 0</span></span>
<span class="srcline"><span class="lineno"><a href="119,39" id="srcline39">39</a></span><span class="line">                <span class="comment">%fprintf('PROGRESS STATUS: dist = %.3f\n',dist);</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,40" id="srcline40">40</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,41" id="srcline41">41</a></span><span class="line">        <span class="keyword">end</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="119,42" id="srcline42">42</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,43" id="srcline43">43</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="119,44" id="srcline44">44</a></span><span class="line">    <span class="comment">%Find the closest node in the tree to the goal node.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,45" id="srcline45">45</a></span><span class="line">    [<span class="mxinfo " id="T51:U162"><span class="var type1" id="S35T51U218">xNearest</span></span>,<span class="mxinfo " id="T4:U164"><span class="mxinfo " id="T4:U165">~</span></span>] = <span class="fcn" id="F266N26:B221">nearestNeighbour</span>(<span class="var type1" id="S27T51U222">sGoal</span>,<span class="var type1" id="S2T52U223">T</span>,<span class="var type1" id="S10T8U224">HGAINS</span>,<span class="var type1" id="S7T5U225">jointLimits</span>,<span class="var type1" id="S16T6U226">kC</span>,<span class="var type1" id="S30T4U227">nodeIDCount</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="119,46" id="srcline46">46</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="119,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T62:U172"><span class="var type1" id="S3T62U230">path</span> = <span class="mxinfo " id="T62:U174"><span class="fcn" id="F367N4:B232">getPath</span>(<span class="var type1" id="S35T51U233">xNearest</span>,<span class="var type1" id="S2T52U234">T</span>,<span class="var type1" id="S14T4U235">dt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,48" id="srcline48">48</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="119,49" id="srcline49">49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,50" id="srcline50">50</a></span><span class="line"></span></span>
</pre>
