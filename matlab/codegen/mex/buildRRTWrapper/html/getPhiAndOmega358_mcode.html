<pre class="code">
<span class="srcline"><span class="lineno"><a href="114,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T4U3">phi</span>,<span class="var type1" id="S3T4U4">omega</span>] = getPhiAndOmega(<span class="var type1" id="S4T48U7">uBDot</span>,<span class="var type1" id="S5T7U8">q</span>,<span class="var type1" id="S6T8U9">qDot</span>,<span class="var type1" id="S7T6U10">kC</span>,<span class="var type1" id="S8T9U11">legNum</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="114,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T8:U8"><span class="var type1" id="S9T8U14">uG</span> = <span class="mxinfo " id="T8:U10">[0 0 0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,5" id="srcline5"> 5</a></span><span class="line">    <span class="comment">%Homogeneous transformation matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,6" id="srcline6"> 6</a></span><span class="line">    [<span class="mxinfo " id="T4:U11"><span class="mxinfo " id="T4:U12">~</span></span>,<span class="mxinfo " id="T10:U13"><span class="var type1" id="S10T10U24">TP2B</span></span>,<span class="mxinfo " id="T10:U15"><span class="var type1" id="S11T10U25">TI2P</span></span>,<span class="mxinfo " id="T10:U17"><span class="var type1" id="S12T10U26">TJ2I</span></span>,<span class="mxinfo " id="T10:U19"><span class="var type1" id="S13T10U27">TO2J</span></span>,<span class="mxinfo " id="T10:U21"><span class="var type1" id="S14T10U28">TQ2O</span></span>,<span class="mxinfo " id="T10:U23"><span class="var type1" id="S15T10U29">TR2Q</span></span>,<span class="mxinfo " id="T10:U25"><span class="var type1" id="S16T10U30">TS2R</span></span>,<span class="mxinfo " id="T4:U27"><span class="mxinfo " id="T4:U28">~</span></span>,<span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T4:U30">~</span></span>] = <span class="fcn" id="F308N11:B34">generateTrMatrices</span>(<span class="mxinfo " id="T8:U31"><span class="var type1" id="S9T8U35">uG</span></span>,<span class="var type1" id="S5T7U36">q</span>,<span class="var type1" id="S7T6U37">kC</span>,<span class="var type1" id="S8T9U38">legNum</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="114,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T10:U36"><span class="var type1" id="S18T10U41">TS2B</span> = <span class="mxinfo " id="T10:U38"><span class="mxinfo " id="T10:U39"><span class="mxinfo " id="T10:U40"><span class="mxinfo " id="T10:U41"><span class="mxinfo " id="T10:U42"><span class="mxinfo " id="T10:U43"><span class="var type1" id="S10T10U48">TP2B</span>*<span class="var type1" id="S11T10U49">TI2P</span></span>*<span class="var type1" id="S12T10U50">TJ2I</span></span>*<span class="var type1" id="S13T10U51">TO2J</span></span>*<span class="var type1" id="S14T10U52">TQ2O</span></span>*<span class="var type1" id="S15T10U53">TR2Q</span></span>*<span class="var type1" id="S16T10U54">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T10:U51"><span class="var type1" id="S19T10U57">TS2P</span> = <span class="mxinfo " id="T10:U53"><span class="mxinfo " id="T10:U54"><span class="mxinfo " id="T10:U55"><span class="mxinfo " id="T10:U56"><span class="mxinfo " id="T10:U57"><span class="var type1" id="S11T10U63">TI2P</span>*<span class="var type1" id="S12T10U64">TJ2I</span></span>*<span class="var type1" id="S13T10U65">TO2J</span></span>*<span class="var type1" id="S14T10U66">TQ2O</span></span>*<span class="var type1" id="S15T10U67">TR2Q</span></span>*<span class="var type1" id="S16T10U68">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T10:U64"><span class="var type1" id="S20T10U71">TS2I</span> = <span class="mxinfo " id="T10:U66"><span class="mxinfo " id="T10:U67"><span class="mxinfo " id="T10:U68"><span class="mxinfo " id="T10:U69"><span class="var type1" id="S12T10U76">TJ2I</span>*<span class="var type1" id="S13T10U77">TO2J</span></span>*<span class="var type1" id="S14T10U78">TQ2O</span></span>*<span class="var type1" id="S15T10U79">TR2Q</span></span>*<span class="var type1" id="S16T10U80">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T10:U75"><span class="var type1" id="S21T10U83">TS2O</span> = <span class="mxinfo " id="T10:U77"><span class="mxinfo " id="T10:U78"><span class="var type1" id="S14T10U86">TQ2O</span>*<span class="var type1" id="S15T10U87">TR2Q</span></span>*<span class="var type1" id="S16T10U88">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T10:U82"><span class="var type1" id="S22T10U91">TB2S</span> = <span class="mxinfo " id="T10:U84"><span class="fcn" id="F41N31:B93">trInv</span>(<span class="var type1" id="S18T10U94">TS2B</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T10:U86"><span class="var type1" id="S24T10U97">TP2S</span> = <span class="mxinfo " id="T10:U88"><span class="fcn" id="F41N31:B99">trInv</span>(<span class="var type1" id="S19T10U100">TS2P</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T10:U90"><span class="var type1" id="S25T10U103">TI2S</span> = <span class="mxinfo " id="T10:U92"><span class="fcn" id="F41N31:B105">trInv</span>(<span class="var type1" id="S20T10U106">TS2I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T10:U94"><span class="var type1" id="S26T10U109">TO2S</span> = <span class="mxinfo " id="T10:U96"><span class="fcn" id="F41N31:B111">trInv</span>(<span class="var type1" id="S21T10U112">TS2O</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%Adjunct transformation matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T58:U98"><span class="var type1" id="S27T58U115">AdB2S</span> = <span class="mxinfo " id="T58:U100"><span class="fcn" id="F326N28:B117">tr2Adj</span>(<span class="var type1" id="S22T10U118">TB2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T58:U102"><span class="var type1" id="S29T58U121">AdP2S</span> = <span class="mxinfo " id="T58:U104"><span class="fcn" id="F326N28:B123">tr2Adj</span>(<span class="var type1" id="S24T10U124">TP2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T58:U106"><span class="var type1" id="S30T58U127">AdI2S</span> = <span class="mxinfo " id="T58:U108"><span class="fcn" id="F326N28:B129">tr2Adj</span>(<span class="var type1" id="S25T10U130">TI2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T58:U110"><span class="var type1" id="S31T58U133">AdO2S</span> = <span class="mxinfo " id="T58:U112"><span class="fcn" id="F326N28:B135">tr2Adj</span>(<span class="var type1" id="S26T10U136">TO2S</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="114,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,24" id="srcline24">24</a></span><span class="line">    <span class="comment">%Pan joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T4:U114"><span class="var type1" id="S32T4U139">alphaDot</span> = <span class="mxinfo " id="T4:U116"><span class="var type1" id="S6T8U141">qDot</span>(<span class="mxinfo " id="T4:U118">1</span>)</span></span>;         <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T8:U119"><span class="var type1" id="S33T8U145">vP</span> = <span class="mxinfo " id="T8:U121">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T8:U122"><span class="var type1" id="S35T8U152">omegaP</span> = <span class="mxinfo " id="T8:U124">[<span class="mxinfo " id="T4:U125">0</span> <span class="mxinfo " id="T4:U126">0</span>  <span class="var type1" id="S32T4U157">alphaDot</span>]</span></span>;   <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T48:U128"><span class="var type1" id="S36T48U160">uPDot</span> = <span class="mxinfo " id="T48:U130"><span class="mxinfo " id="T21:U131">[<span class="var type1" id="S33T8U164">vP</span> <span class="var type1" id="S35T8U165">omegaP</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%Beta joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T4:U134"><span class="var type1" id="S37T4U168">betaDot</span> = <span class="mxinfo " id="T4:U136"><span class="var type1" id="S6T8U170">qDot</span>(<span class="mxinfo " id="T4:U138">2</span>)</span></span>;          <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo " id="T8:U139"><span class="var type1" id="S38T8U174">vI</span> = <span class="mxinfo " id="T8:U141">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T8:U142"><span class="var type1" id="S39T8U181">omegaI</span> = <span class="mxinfo " id="T8:U144">[<span class="mxinfo " id="T4:U145">0</span> <span class="mxinfo " id="T4:U146">0</span>  <span class="var type1" id="S37T4U186">betaDot</span>]</span></span>;    <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T48:U148"><span class="var type1" id="S40T48U189">uIDot</span> = <span class="mxinfo " id="T48:U150"><span class="mxinfo " id="T21:U151">[<span class="var type1" id="S38T8U193">vI</span> <span class="var type1" id="S39T8U194">omegaI</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,36" id="srcline36">36</a></span><span class="line">    <span class="comment">%Gamma joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T4:U154"><span class="var type1" id="S41T4U197">gammaDot</span> = <span class="mxinfo " id="T4:U156"><span class="var type1" id="S6T8U199">qDot</span>(<span class="mxinfo " id="T4:U158">3</span>)</span></span>;         <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T8:U159"><span class="var type1" id="S42T8U203">vO</span> = <span class="mxinfo " id="T8:U161">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T8:U162"><span class="var type1" id="S43T8U210">omegaO</span> = <span class="mxinfo " id="T8:U164">[<span class="mxinfo " id="T4:U165">0</span> <span class="mxinfo " id="T4:U166">0</span>  <span class="var type1" id="S41T4U215">gammaDot</span>]</span></span>;   <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T48:U168"><span class="var type1" id="S44T48U218">uODot</span> = <span class="mxinfo " id="T48:U170"><span class="mxinfo " id="T21:U171">[<span class="var type1" id="S42T8U222">vO</span> <span class="var type1" id="S43T8U223">omegaO</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,42" id="srcline42">42</a></span><span class="line">    <span class="comment">%Velocity vector for the ankle frame.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T48:U174"><span class="var type1" id="S45T48U226">uSDot</span> = <span class="mxinfo " id="T48:U176"><span class="mxinfo " id="T48:U177"><span class="mxinfo " id="T48:U178"><span class="mxinfo " id="T48:U179"><span class="var type1" id="S27T58U231">AdB2S</span>*<span class="var type1" id="S4T48U232">uBDot</span></span> + <span class="mxinfo " id="T48:U182"><span class="var type1" id="S29T58U234">AdP2S</span>*<span class="var type1" id="S36T48U235">uPDot</span></span></span> + <span class="mxinfo " id="T48:U185"><span class="var type1" id="S30T58U237">AdI2S</span>*<span class="var type1" id="S40T48U238">uIDot</span></span></span> + <span class="mxinfo " id="T48:U188"><span class="var type1" id="S31T58U240">AdO2S</span>*<span class="var type1" id="S44T48U241">uODot</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T12:U191"><span class="var type1" id="S46T12U244">vS</span> = <span class="mxinfo " id="T12:U193"><span class="var type1" id="S45T48U246">uSDot</span>(<span class="mxinfo " id="T8:U195"><span class="mxinfo " id="T4:U196">1</span>:<span class="mxinfo " id="T4:U197">3</span></span>)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T12:U198"><span class="var type1" id="S47T12U252">omegaS</span> = <span class="mxinfo " id="T12:U200"><span class="var type1" id="S45T48U254">uSDot</span>(<span class="mxinfo " id="T8:U202"><span class="mxinfo " id="T4:U203">4</span>:<span class="mxinfo " id="T4:U204">6</span></span>)</span></span>;        <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,46" id="srcline46">46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,47" id="srcline47">47</a></span><span class="line">    <span class="comment">%Calculate the required phi joint angle and the required wheel speed,</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,48" id="srcline48">48</a></span><span class="line">    <span class="comment">%omega.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T4:U205"><span class="var type1" id="S2T4U260">phi</span> = <span class="mxinfo " id="T4:U207">atan2(<span class="mxinfo " id="T4:U208"><span class="var type1" id="S46T12U264">vS</span>(<span class="mxinfo " id="T4:U210">2</span>)</span>,<span class="mxinfo " id="T4:U211"><span class="var type1" id="S46T12U267">vS</span>(<span class="mxinfo " id="T4:U213">1</span>)</span>)</span></span>;   <span class="comment">%[rad]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T4:U214"><span class="var type1" id="S3T4U271">omega</span> = <span class="mxinfo " id="T4:U216"><span class="mxinfo " id="T4:U217">norm(<span class="var type1" id="S46T12U275">vS</span>)</span>/<span class="mxinfo " id="T4:U219"><span class="var type1" id="S7T6U277">kC</span>.r</span></span></span>;      <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
