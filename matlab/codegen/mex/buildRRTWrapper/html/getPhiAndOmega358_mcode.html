<pre class="code">
<span class="srcline"><span class="lineno"><a href="114,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T4U3">phi</span>,<span class="var type1" id="S3T4U4">omega</span>] = getPhiAndOmega(<span class="var type1" id="S4T48U7">uBDot</span>,<span class="var type1" id="S5T7U8">q</span>,<span class="var type1" id="S6T6U9">kC</span>,<span class="var type1" id="S7T9U10">legNum</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="114,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T8:U7"><span class="var type1" id="S8T8U13">uG</span> = <span class="mxinfo " id="T8:U9">[0 0 0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,5" id="srcline5"> 5</a></span><span class="line">    <span class="comment">%Homogeneous transformation matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,6" id="srcline6"> 6</a></span><span class="line">    [<span class="mxinfo " id="T4:U10"><span class="mxinfo " id="T4:U11">~</span></span>,<span class="mxinfo " id="T10:U12"><span class="var type1" id="S9T10U23">TP2B</span></span>,<span class="mxinfo " id="T10:U14"><span class="var type1" id="S10T10U24">TI2P</span></span>,<span class="mxinfo " id="T10:U16"><span class="var type1" id="S11T10U25">TJ2I</span></span>,<span class="mxinfo " id="T10:U18"><span class="var type1" id="S12T10U26">TO2J</span></span>,<span class="mxinfo " id="T10:U20"><span class="var type1" id="S13T10U27">TQ2O</span></span>,<span class="mxinfo " id="T10:U22"><span class="var type1" id="S14T10U28">TR2Q</span></span>,<span class="mxinfo " id="T10:U24"><span class="var type1" id="S15T10U29">TS2R</span></span>,<span class="mxinfo " id="T4:U26"><span class="mxinfo " id="T4:U27">~</span></span>,<span class="mxinfo " id="T4:U28"><span class="mxinfo " id="T4:U29">~</span></span>] = <span class="fcn" id="F308N11:B33">generateTrMatrices</span>(<span class="mxinfo " id="T8:U30"><span class="var type1" id="S8T8U34">uG</span></span>,<span class="var type1" id="S5T7U35">q</span>,<span class="var type1" id="S6T6U36">kC</span>,<span class="var type1" id="S7T9U37">legNum</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="114,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T10:U35"><span class="var type1" id="S17T10U40">TS2B</span> = <span class="mxinfo " id="T10:U37"><span class="mxinfo " id="T10:U38"><span class="mxinfo " id="T10:U39"><span class="mxinfo " id="T10:U40"><span class="mxinfo " id="T10:U41"><span class="mxinfo " id="T10:U42"><span class="var type1" id="S9T10U47">TP2B</span>*<span class="var type1" id="S10T10U48">TI2P</span></span>*<span class="var type1" id="S11T10U49">TJ2I</span></span>*<span class="var type1" id="S12T10U50">TO2J</span></span>*<span class="var type1" id="S13T10U51">TQ2O</span></span>*<span class="var type1" id="S14T10U52">TR2Q</span></span>*<span class="var type1" id="S15T10U53">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T10:U50"><span class="var type1" id="S18T10U56">TS2P</span> = <span class="mxinfo " id="T10:U52"><span class="mxinfo " id="T10:U53"><span class="mxinfo " id="T10:U54"><span class="mxinfo " id="T10:U55"><span class="mxinfo " id="T10:U56"><span class="var type1" id="S10T10U62">TI2P</span>*<span class="var type1" id="S11T10U63">TJ2I</span></span>*<span class="var type1" id="S12T10U64">TO2J</span></span>*<span class="var type1" id="S13T10U65">TQ2O</span></span>*<span class="var type1" id="S14T10U66">TR2Q</span></span>*<span class="var type1" id="S15T10U67">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T10:U63"><span class="var type1" id="S19T10U70">TS2I</span> = <span class="mxinfo " id="T10:U65"><span class="mxinfo " id="T10:U66"><span class="mxinfo " id="T10:U67"><span class="mxinfo " id="T10:U68"><span class="var type1" id="S11T10U75">TJ2I</span>*<span class="var type1" id="S12T10U76">TO2J</span></span>*<span class="var type1" id="S13T10U77">TQ2O</span></span>*<span class="var type1" id="S14T10U78">TR2Q</span></span>*<span class="var type1" id="S15T10U79">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T10:U74"><span class="var type1" id="S20T10U82">TS2O</span> = <span class="mxinfo " id="T10:U76"><span class="mxinfo " id="T10:U77"><span class="var type1" id="S13T10U85">TQ2O</span>*<span class="var type1" id="S14T10U86">TR2Q</span></span>*<span class="var type1" id="S15T10U87">TS2R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T10:U81"><span class="var type1" id="S21T10U90">TB2S</span> = <span class="mxinfo " id="T10:U83"><span class="fcn" id="F41N31:B92">trInv</span>(<span class="var type1" id="S17T10U93">TS2B</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T10:U85"><span class="var type1" id="S23T10U96">TP2S</span> = <span class="mxinfo " id="T10:U87"><span class="fcn" id="F41N31:B98">trInv</span>(<span class="var type1" id="S18T10U99">TS2P</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T10:U89"><span class="var type1" id="S24T10U102">TI2S</span> = <span class="mxinfo " id="T10:U91"><span class="fcn" id="F41N31:B104">trInv</span>(<span class="var type1" id="S19T10U105">TS2I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T10:U93"><span class="var type1" id="S25T10U108">TO2S</span> = <span class="mxinfo " id="T10:U95"><span class="fcn" id="F41N31:B110">trInv</span>(<span class="var type1" id="S20T10U111">TS2O</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%Adjunct transformation matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T58:U97"><span class="var type1" id="S26T58U114">AdB2S</span> = <span class="mxinfo " id="T58:U99"><span class="fcn" id="F326N28:B116">tr2Adj</span>(<span class="var type1" id="S21T10U117">TB2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T58:U101"><span class="var type1" id="S28T58U120">AdP2S</span> = <span class="mxinfo " id="T58:U103"><span class="fcn" id="F326N28:B122">tr2Adj</span>(<span class="var type1" id="S23T10U123">TP2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T58:U105"><span class="var type1" id="S29T58U126">AdI2S</span> = <span class="mxinfo " id="T58:U107"><span class="fcn" id="F326N28:B128">tr2Adj</span>(<span class="var type1" id="S24T10U129">TI2S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T58:U109"><span class="var type1" id="S30T58U132">AdO2S</span> = <span class="mxinfo " id="T58:U111"><span class="fcn" id="F326N28:B134">tr2Adj</span>(<span class="var type1" id="S25T10U135">TO2S</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="114,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,24" id="srcline24">24</a></span><span class="line">    <span class="comment">%Pan joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T4:U113"><span class="var type1" id="S31T4U138">alphaDot</span> = <span class="mxinfo " id="T4:U115">0</span></span>;               <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T8:U116"><span class="var type1" id="S32T8U142">vP</span> = <span class="mxinfo " id="T8:U118">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T8:U119"><span class="var type1" id="S34T8U149">omegaP</span> = <span class="mxinfo " id="T8:U121">[0 0  <span class="var type1" id="S31T4U154">alphaDot</span>]</span></span>;   <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T48:U123"><span class="var type1" id="S35T48U157">uPDot</span> = <span class="mxinfo " id="T48:U125">[<span class="var type1" id="S32T8U161">vP</span> <span class="var type1" id="S34T8U162">omegaP</span>]'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%Beta joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T4:U128"><span class="var type1" id="S36T4U165">betaDot</span> = <span class="mxinfo " id="T4:U130">0</span></span>;                <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo " id="T8:U131"><span class="var type1" id="S37T8U169">vI</span> = <span class="mxinfo " id="T8:U133">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T8:U134"><span class="var type1" id="S38T8U176">omegaI</span> = <span class="mxinfo " id="T8:U136">[0 0  <span class="var type1" id="S36T4U181">betaDot</span>]</span></span>;    <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T48:U138"><span class="var type1" id="S39T48U184">uIDot</span> = <span class="mxinfo " id="T48:U140">[<span class="var type1" id="S37T8U188">vI</span> <span class="var type1" id="S38T8U189">omegaI</span>]'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,36" id="srcline36">36</a></span><span class="line">    <span class="comment">%Gamma joint rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T4:U143"><span class="var type1" id="S40T4U192">gammaDot</span> = <span class="mxinfo " id="T4:U145">0</span></span>;               <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T8:U146"><span class="var type1" id="S41T8U196">vO</span> = <span class="mxinfo " id="T8:U148">zeros(1,3)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T8:U149"><span class="var type1" id="S42T8U203">omegaO</span> = <span class="mxinfo " id="T8:U151">[0 0  <span class="var type1" id="S40T4U208">gammaDot</span>]</span></span>;   <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T48:U153"><span class="var type1" id="S43T48U211">uODot</span> = <span class="mxinfo " id="T48:U155">[<span class="var type1" id="S41T8U215">vO</span> <span class="var type1" id="S42T8U216">omegaO</span>]'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,42" id="srcline42">42</a></span><span class="line">    <span class="comment">%Velocity vector for the ankle frame.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T48:U158"><span class="var type1" id="S44T48U219">uSDot</span> = <span class="mxinfo " id="T48:U160"><span class="mxinfo " id="T48:U161"><span class="mxinfo " id="T48:U162"><span class="mxinfo " id="T48:U163"><span class="var type1" id="S26T58U224">AdB2S</span>*<span class="var type1" id="S4T48U225">uBDot</span></span> + <span class="mxinfo " id="T48:U166"><span class="var type1" id="S28T58U227">AdP2S</span>*<span class="mxinfo " id="T48:U168"><span class="var type1" id="S35T48U228">uPDot</span></span></span></span> + <span class="mxinfo " id="T48:U170"><span class="var type1" id="S29T58U230">AdI2S</span>*<span class="mxinfo " id="T48:U172"><span class="var type1" id="S39T48U231">uIDot</span></span></span></span> + <span class="mxinfo " id="T48:U174"><span class="var type1" id="S30T58U233">AdO2S</span>*<span class="mxinfo " id="T48:U176"><span class="var type1" id="S43T48U234">uODot</span></span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T12:U178"><span class="var type1" id="S45T12U237">vS</span> = <span class="mxinfo " id="T12:U180"><span class="var type1" id="S44T48U239">uSDot</span>(<span class="mxinfo " id="T8:U182"><span class="mxinfo " id="T4:U183">1</span>:<span class="mxinfo " id="T4:U184">3</span></span>)</span></span>;            <span class="comment">%[m/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T12:U185"><span class="var type1" id="S46T12U245">omegaS</span> = <span class="mxinfo " id="T12:U187"><span class="var type1" id="S44T48U247">uSDot</span>(<span class="mxinfo " id="T8:U189"><span class="mxinfo " id="T4:U190">4</span>:<span class="mxinfo " id="T4:U191">6</span></span>)</span></span>;        <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,46" id="srcline46">46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,47" id="srcline47">47</a></span><span class="line">    <span class="comment">%Calculate the required phi joint angle and the required wheel speed,</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,48" id="srcline48">48</a></span><span class="line">    <span class="comment">%omega.</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T4:U192"><span class="var type1" id="S2T4U253">phi</span> = <span class="mxinfo " id="T4:U194">atan2(<span class="mxinfo " id="T4:U195"><span class="var type1" id="S45T12U257">vS</span>(<span class="mxinfo " id="T4:U197">2</span>)</span>,<span class="mxinfo " id="T4:U198"><span class="var type1" id="S45T12U260">vS</span>(<span class="mxinfo " id="T4:U200">1</span>)</span>)</span></span>;   <span class="comment">%[rad]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T4:U201"><span class="var type1" id="S3T4U264">omega</span> = <span class="mxinfo " id="T4:U203"><span class="mxinfo " id="T4:U204">norm(<span class="var type1" id="S45T12U268">vS</span>)</span>/<span class="mxinfo " id="T4:U206"><span class="var type1" id="S6T6U270">kC</span>.r</span></span></span>;      <span class="comment">%[rad/s]</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
